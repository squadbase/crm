# Orders ãƒšãƒ¼ã‚¸å®Ÿè£…æ–¹é‡æ¤œè¨¼çµæœ

## æ¤œè¨¼æ¦‚è¦

`docs/pages/orders/design.md`ã«è¨˜è¼‰ã•ã‚ŒãŸå®Ÿè£…æ–¹é‡ã«ã¤ã„ã¦ã€å®Ÿéš›ã®PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§SQLã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã€æŠ€è¡“çš„æ¤œè¨¼ã‚’è¡Œã„ã¾ã—ãŸã€‚

## æ¤œè¨¼çµæœ

### âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç’°å¢ƒ
- **ãƒ†ãƒ¼ãƒ–ãƒ«å­˜åœ¨ç¢ºèª**: orders, customersãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ­£å¸¸ã«ä½œæˆæ¸ˆã¿
- **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿**: customers 5ä»¶ã€orders 10ä»¶ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§æ¤œè¨¼å®Ÿæ–½

### âœ… ä¸»è¦SQLã‚¯ã‚¨ãƒªæ¤œè¨¼

#### 1. æ³¨æ–‡ä¸€è¦§å–å¾—ã‚¯ã‚¨ãƒªï¼ˆJOINï¼‰
```sql
SELECT o.order_id, o.customer_id, c.customer_name, o.payment_type, o.service_type, 
       o.sales_start_dt, o.sales_end_dt, o.amount, o.currency, o.is_paid, 
       o.description, o.created_at, o.updated_at 
FROM orders o 
JOIN customers c ON o.customer_id = c.customer_id 
ORDER BY o.created_at DESC LIMIT 5;
```
**çµæœ**: âœ… æ­£å¸¸å®Ÿè¡Œ - é¡§å®¢åã¨orderæƒ…å ±ãŒæ­£ã—ãJOINã•ã‚Œã¦å–å¾—

#### 2. å£²ä¸Šé›†è¨ˆã‚¯ã‚¨ãƒª
```sql
SELECT COUNT(*) as total_orders, SUM(amount) as total_amount,
       SUM(CASE WHEN is_paid = true THEN amount ELSE 0 END) as paid_amount,
       SUM(CASE WHEN is_paid = false THEN amount ELSE 0 END) as unpaid_amount
FROM orders;
```
**çµæœ**: âœ… æ­£å¸¸å®Ÿè¡Œ
- ç·æ³¨æ–‡æ•°: 10ä»¶
- ç·å£²ä¸Š: 3,740,000å††
- æ”¯æ‰•æ¸ˆ: 2,540,000å††  
- æœªæ‰•: 1,200,000å††

#### 3. ã‚µãƒ¼ãƒ“ã‚¹ç¨®åˆ¥ã”ã¨ã®é›†è¨ˆ
```sql
SELECT service_type, COUNT(*) as count, SUM(amount) as total_amount 
FROM orders GROUP BY service_type;
```
**çµæœ**: âœ… æ­£å¸¸å®Ÿè¡Œ
- project: 5ä»¶ï¼ˆ3,400,000å††ï¼‰
- squadbase: 5ä»¶ï¼ˆ340,000å††ï¼‰

#### 4. æ¤œç´¢æ©Ÿèƒ½ï¼ˆILIKEï¼‰
```sql
SELECT o.order_id, c.customer_name, o.payment_type, o.service_type 
FROM orders o JOIN customers c ON o.customer_id = c.customer_id 
WHERE c.customer_name ILIKE '%ãƒ†ãƒƒã‚¯%' OR o.description ILIKE '%CRM%';
```
**çµæœ**: âœ… æ­£å¸¸å®Ÿè¡Œ - é¡§å®¢åãƒ»èª¬æ˜æ–‡ã§ã®éƒ¨åˆ†ä¸€è‡´æ¤œç´¢ãŒå‹•ä½œ

#### 5. æœˆæ¬¡é›†è¨ˆï¼ˆDATE_TRUNCï¼‰
```sql
SELECT DATE_TRUNC('month', sales_start_dt) as month, SUM(amount) as monthly_amount 
FROM orders GROUP BY DATE_TRUNC('month', sales_start_dt) ORDER BY month;
```
**çµæœ**: âœ… æ­£å¸¸å®Ÿè¡Œ - æœˆæ¬¡å£²ä¸Šé›†è¨ˆãŒæ­£ã—ãå‹•ä½œ

### âœ… æŠ€è¡“ä»•æ§˜æ¤œè¨¼

#### ãƒ‡ãƒ¼ã‚¿å‹ã®é©åˆæ€§
- UUIDå‹: order_id, customer_idãŒæ­£å¸¸å‹•ä½œ
- ENUMå‹: payment_type, service_typeãŒæ­£å¸¸å‹•ä½œ  
- DECIMALå‹: amountã®é‡‘é¡è¨ˆç®—ãŒæ­£ç¢º
- DATEå‹: sales_start_dt, sales_end_dtã§ã®æœŸé–“å‡¦ç†ãŒæ­£å¸¸

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®
- JOINã‚¯ã‚¨ãƒªãŒåŠ¹ç‡çš„ã«å®Ÿè¡Œ
- PostgreSQLãƒã‚¤ãƒ†ã‚£ãƒ–é›†è¨ˆæ©Ÿèƒ½ã®æ´»ç”¨ãŒé©åˆ‡
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆï¼ˆå¤–éƒ¨ã‚­ãƒ¼ã€æ—¥ä»˜ï¼‰ãŒæœ‰åŠ¹

## æ”¹å–„ææ¡ˆ

### ğŸ”„ è»½å¾®ãªä¿®æ­£ææ¡ˆ

#### 1. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã®è¿½åŠ æ¤œè¨¼
æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®WHEREå¥ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®å½¢å¼ã§ã®æ¤œè¨¼ã‚’æ¨å¥¨ï¼š
```sql
WHERE sales_start_dt BETWEEN '2024-01-01' AND '2024-12-31'
```

#### 2. ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æœ€é©åŒ–
OFFSET/LIMITã§ã¯ãªãã€cursor-based paginationã‚‚æ¤œè¨å¯èƒ½ï¼š
```sql
WHERE created_at < ? ORDER BY created_at DESC LIMIT 50
```

### âœ… è¨­è¨ˆæ–¹é‡ã®å¦¥å½“æ€§

1. **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨­è¨ˆ**: PageHeaderã‚’æ´»ç”¨ã—ãŸçµ±ä¸€æ„Ÿã®ã‚ã‚‹è¨­è¨ˆ
2. **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†å‰²**: ä¿å®ˆæ€§ã‚’è€ƒæ…®ã—ãŸé©åˆ‡ãªåˆ†å‰²
3. **APIè¨­è¨ˆ**: RESTfulè¨­è¨ˆã®æ¡ç”¨ãŒé©åˆ‡
4. **çŠ¶æ…‹ç®¡ç†**: Next.jsæ¨™æº–ã®useStateã§ååˆ†ãªè¦æ¨¡

## ç·åˆè©•ä¾¡

### è©•ä¾¡ç‚¹æ•°: **92/100ç‚¹**

### è©•ä¾¡è©³ç´°
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ**: 95/100 (ENUMã‚„åˆ¶ç´„ãŒé©åˆ‡)
- **SQLã‚¯ã‚¨ãƒªè¨­è¨ˆ**: 90/100 (åŠ¹ç‡çš„ã§å®Ÿç”¨çš„)
- **UI/UXè¨­è¨ˆ**: 90/100 (ä¸€è²«æ€§ã®ã‚ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³)
- **æŠ€è¡“é¸æŠ**: 95/100 (é©åˆ‡ãªæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)

### å®Ÿè£…åˆ¤å®š: **âœ… å®Ÿè£…ã«é€²ã‚“ã§è‰¯ã„ãƒ¬ãƒ™ãƒ«**

## å®Ÿè£…æ¨å¥¨äº‹é …

1. å®Ÿè£…æ–¹é‡é€šã‚Šã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ
2. SQLã‚¯ã‚¨ãƒªã¯æ¤œè¨¼æ¸ˆã¿ã®ã‚‚ã®ã‚’ãƒ™ãƒ¼ã‚¹ã«ä½¿ç”¨
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è€ƒæ…®
4. ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã®å®Ÿè£…ç¢ºèª
5. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã®æ®µéšçš„å®Ÿè£…

## æ³¨æ„ç‚¹

1. **é‡‘é¡è¡¨ç¤º**: DECIMALå‹ã®ç²¾åº¦ã‚’ä¿æŒã—ã¦ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§è¡¨ç¤º
2. **æ—¥ä»˜å‡¦ç†**: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’è€ƒæ…®ã—ãŸæ—¥ä»˜å¤‰æ›
3. **ENUMãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®ENUMå€¤æ¤œè¨¼
4. **æ¤œç´¢æ€§èƒ½**: å¤§é‡ãƒ‡ãƒ¼ã‚¿æ™‚ã®ILIKEæ¤œç´¢ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

æœ¬æ¤œè¨¼çµæœã«ã‚ˆã‚Šã€è¨­è¨ˆã•ã‚ŒãŸå®Ÿè£…æ–¹é‡ã¯æŠ€è¡“çš„ã«å®Ÿç¾å¯èƒ½ã§ã‚ã‚Šã€å®Ÿè£…ã«é€²ã‚€ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚